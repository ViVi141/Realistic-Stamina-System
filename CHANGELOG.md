# 更新日志

所有重要的项目变更都会记录在此文件中。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
并且本项目遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

## [2.2.0]

### 新增
- **双稳态-应激性能模型（Dual-State Stress Performance Model）**
  - 平台期（25%-100%体力）：保持恒定目标速度（3.7 m/s），模拟意志力克服早期疲劳
  - 衰减期（0%-25%体力）：速度平滑下降到跛行速度，使用SmoothStep过渡（25%-5%缓冲区）
- **5秒阻尼过渡（"撞墙"瞬间优化）**
  - 在体力触及25%临界点时，使用5秒时间阻尼过渡，让玩家感觉"腿越来越重"
  - 避免速度瞬间跳变（"引擎突然断油"），提供平滑的疲劳体验
  - 使用SmoothStep函数实现渐进式速度下降
- **坡度自适应步幅逻辑（坡度-速度负反馈）**
  - 上坡时自动降低目标速度（每度降低2.5%），换取更持久的续航
  - 模拟现实中人爬坡时自动缩短步幅的行为
- **坡度消耗非线性增长（幂函数）**
  - 使用 `(gradePercent × 0.01)^1.2 × 5.0` 替代线性增长
  - 小坡（5%以下）几乎无感，陡坡才真正吃力，避免Everon缓坡频繁断气
- **体力消耗生理上限（VO2 Max限制）**
  - 每0.2秒最大消耗不超过0.02（每秒最多掉10%）
  - 防止负重+坡度组合导致的数值爆炸

### 改进
- **平滑过渡优化**：将缓冲区间从10%-25%扩展至5%-25%，避免突兀的"撞墙"效果
- **"撞墙"瞬间优化**：在体力触及25%临界点时，添加5秒阻尼过渡机制
  - 使用时间插值（SmoothStep）实现渐进式速度下降
  - 让玩家感觉"腿越来越重"，而不是"引擎突然断油"
  - 速度在5秒内从3.7 m/s逐渐降到约2.2 m/s
- **负重影响优化**：负重主要影响"油耗"（体力消耗）而非直接降低"最高档位"（速度）
  - 负重对速度的影响从50%降低到20%
  - 30kg负重时仍能短时间跑3.7 m/s，只是消耗更快
- **重载下恢复优化**：负重时恢复速率提升（0-30kg：10%提升，30-40.5kg：30%提升）
  - 模拟士兵通过深呼吸快速调整的能力
  - 避免重装冲刺后的"跛行"惩罚太久

### 技术改进
- 实现SmoothStep函数（三阶多项式插值）用于平滑过渡
- 5秒阻尼过渡机制：时间跟踪变量（`m_bInCollapseTransition`, `m_fCollapseTransitionStartTime`）
- 坡度自适应函数：`CalculateSlopeAdjustedTargetSpeed()`
- 非线性坡度消耗：`CalculateGradeMultiplier()` 使用幂函数
- 生理上限限制：在体力消耗计算后应用 `MAX_DRAIN_RATE_PER_TICK`

## [2.1.0]

### 新增
- 参数优化功能，达到2英里15分27秒目标
- 精确数学模型实现（α=0.6，Pandolf模型）
- 完整的原生体力系统覆盖机制
- 高频监控系统（50ms间隔）

### 改进
- 速度倍数从0.885提升至0.920（满体力速度4.78 m/s）
- 速度平方项系数从0.0003降低至0.0001
- 使用目标体力值而非当前体力值进行计算，避免原生系统干扰
- 优化监控频率，平衡性能和拦截效果

### 修复
- 修复原生体力系统干扰问题
- 修复体力恢复速度异常问题
- 修复监控机制中的逻辑问题

### 技术改进
- 实现精确的幂函数计算（牛顿法）
- 完整的 Pandolf 模型实现
- 改进的拦截机制（OnStaminaDrain事件覆盖 + 主动监控）

## [2.0.0] 

### 新增
- 动态速度调整系统（根据体力百分比）
- 负重影响系统（负重影响速度）
- 精确数学模型（不使用近似）
- 综合状态显示（速度、体力、倍率）
- 平滑速度过渡机制

### 技术实现
- 使用 `modded class SCR_CharacterStaminaComponent` 扩展体力组件
- 使用 `modded class SCR_CharacterControllerComponent` 显示状态信息
- 通过 `OverrideMaxSpeed(fraction)` 动态设置最大速度倍数

## [1.0.0]

### 新增
- 初始版本
- 固定速度修改功能（50%）
- 速度显示功能（每秒一次）

[2.1.0]: https://github.com/ViVi141/test_rubn_speed/releases/tag/v2.1.0
[2.0.0]: https://github.com/ViVi141/test_rubn_speed/releases/tag/v2.0.0
[1.0.0]: https://github.com/ViVi141/test_rubn_speed/releases/tag/v1.0.0
