# Military Stamina System Model Specification

## 模型规范

### 1. 核心身份和变量

- **目标**：22岁男性，90kg体重
- **总质量 (M)**：91.5 kg（90kg身体 + 1.5kg装备）
- **体力池 (S)**：0.0 ~ 100.0 浮点数
- **初始状态**：S = 85.0（ACFT后预疲劳状态）

### 2. 移动状态常量（0%坡度）

| 状态 | 速度 (V) | 消耗率 (D_base) | 逻辑 |
|------|----------|-----------------|------|
| Sprint | 5.2 m/s | 0.480 pts/s | 无氧；高消耗 |
| Run | 3.7 m/s | 0.105 pts/s | 阈值；匹配15:27的2英里配速 |
| Walk | 3.2 m/s | 0.060 pts/s | 活跃有氧；低消耗 |
| Rest | 0.0 m/s | -0.250 pts/s | 恢复（负消耗） |

### 3. 环境修正（坡度 G）

坡度 (G) 以百分比表示（例如，5% = 5.0）

**乘数 (K_grade)**：
- 上坡 (G > 0)：`K_grade = 1 + (G × 0.12)`
- 下坡 (G < 0)：`K_grade = 1 + (G × 0.05)`（假设）

**物理逻辑**：对于90kg士兵，每1%上坡增加12%代谢需求

**高坡度额外修正**：
- 当 G > 15% 时，`D_base` 应该有额外的 `1.2×` 乘数（由于90kg框架的机械效率低下）

### 4. 数学执行（每帧）

```python
# 伪代码
if velocity >= 5.2:
    base_drain = 0.480  # Sprint
elif velocity >= 3.7:
    base_drain = 0.105  # Run
elif velocity >= 3.2:
    base_drain = 0.060  # Walk
else:
    base_drain = -0.250  # Rest (恢复)

# 坡度修正
if current_grade > 0:
    k_grade = 1.0 + (current_grade * 0.12)
elif current_grade < 0:
    k_grade = 1.0 + (current_grade * 0.05)  # 下坡减少消耗
else:
    k_grade = 1.0

# 高坡度额外修正
if current_grade > 15.0:
    k_grade *= 1.2

# 更新体力
stamina -= (base_drain * k_grade) * delta_time
```

### 5. 约束和边界情况

1. **精疲力尽**：
   - 如果 S ≤ 0，强制速度为 1.0 m/s（跛行）
   - 禁用Sprint直到 S ≥ 20

2. **坡度限制**：
   - 当 G > 15% 时，`D_base` 应该有额外的 `1.2×` 乘数

3. **ACFT目标校准**：
   - 在 V = 3.7, G = 0 时，S 将从 85 → 0 在约 927 秒内（15:27）

## 与现有模型的对比

### 现有模型特点：
- 体力池：0.0-1.0（百分比）
- 基于Pandolf模型的复杂计算
- 多维度模型（健康状态、累积疲劳、代谢适应等）
- 基于速度比和多项式的消耗计算
- 更新间隔：0.2秒

### 新模型特点：
- 体力池：0.0-100.0（点数）
- 基于速度阈值的分段消耗率
- 简化的坡度修正
- 高坡度额外修正
- 精疲力尽逻辑

## 实现建议

### 方案1：完全替换现有模型
- 优点：模型简单清晰，易于理解和调试
- 缺点：失去现有的多维度模型优势

### 方案2：融合两种模型
- 保留现有模型的多维度特性
- 添加基于速度阈值的分段消耗率
- 添加精疲力尽逻辑
- 调整坡度修正以匹配新规范

### 方案3：创建新模型作为选项
- 保留现有模型
- 添加新模型作为可选模式
- 用户可以选择使用哪个模型

## 推荐方案

**推荐方案2（融合模型）**，原因：
1. 保留现有模型的多维度优势（健康状态、累积疲劳、代谢适应）
2. 添加基于速度阈值的分段消耗率，使模型更直观
3. 添加精疲力尽逻辑，增强游戏体验
4. 调整坡度修正以匹配新规范

## 需要实现的功能

1. ✅ 基于速度阈值的分段消耗率
2. ✅ 坡度修正（K_grade = 1 + G × 0.12 for G > 0）
3. ✅ 高坡度额外修正（G > 15%时，1.2×乘数）
4. ✅ 精疲力尽逻辑（S ≤ 0时，强制速度1.0 m/s，禁用Sprint直到S ≥ 20）
5. ⚠️ 体力池范围调整（0.0-100.0 vs 0.0-1.0）- 需要确认是否调整
